array = [
{"id" => 1, "dep" => "a1", "math" => 43, "phy" => 54, "chem" => 65, "year"=>"2016"},
{"id" => 2, "dep" => "a1", "math" => 66, "phy" => 52, "chem" => 65, "year"=>"2016"},
{"id" => 3, "dep" => "a7", "math" => 87, "phy" => 32, "chem" => 43, "year"=>"2016"},
{"id" => 1, "dep" => "a1", "math" => 21, "phy" => 52, "chem" => 65, "year"=>"2015"},
{"id" => 2, "dep" => "a1", "math" => 68, "phy" => 50, "chem" => 65, "year"=>"2015"},
{"id" => 3, "dep" => "a7", "math" => 85, "phy" => 22, "chem" => 43, "year"=>"2015"},
{"id" => 4, "dep" => "a7", "math" => 21, "phy" => 22, "chem" => 13, "year"=>"2016"}
]

def sort_input(array, on)
    out = array.sort_by {|item| item[on] } 	
end

def group_input(out, on)
     out = out.group_by { |item| item[on] }
end

def get_compared(input, out, compare, give_key, change)
   current = 0
   past = 0
   out.each do |x|
     hash = {}
     a=[]
     for index in 2...5
       key = give_key[index]
       x[1].each do |y|
          if y["year"] == compare[0]
                current = y[key]
          elsif y["year"] == compare[1]
                past = y[key]
          end
       end
       hash[key] = "#{(current-past)}"
     end
    a.push(hash)
    change.push(a)
   end
  return change
end

def get_total(input, out, compare, give_key, total)
   out.each do |x|
     hash = {}
     a=[]
     for index in 2...5
       tot = 0
       key = give_key[index]
       x[1].each do |y|
          if input[3] == "false"
             tot = tot + y[key]
          elsif (y["year"] == compare[0]) || (y["year"] == compare[1])
             tot = tot + y[key]
          end
       end
       hash[key] = tot
     end
    a.push(hash)
    total.push(a)
   end
  return total
end

def final_display(out, change, total, input)
  count = 0
  display = input[2].split(",")
  print "#{input[0]}      "
  display.each { |e| print "| #{e}  " }
  out.each do |x| 
     puts ""
     print "#{x[0]}"
     x[1].each do |y|
       puts ""
       print "#{y["year"]}       "
       print "#{y["math"]}     " if display.include? "math" 
       print "#{y["phy"]}      " if display.include? "phy"
       print "#{y["chem"]}     " if display.include? "chem"
     end
     puts ""
     if input[3] == "true"
       print "Change     "
       change[count].each do |f|
         print "#{f["math"]}     " if display.include? "math" 
         print "#{f["phy"]}     " if display.include? "phy"
         print "#{f["chem"]}" if display.include? "chem"
       end
     end
     puts ""
     if input[4] == "true"
       print "Topic      "
       total[count].each do |u|
         print "#{u["math"]}     " if display.include? "math" 
         print "#{u["phy"]}     " if display.include? "phy"
         print "#{u["chem"]}" if display.include? "chem"
       end
     end
     count += 1
     puts ""
   end
   puts ""
end

def user_input(fields)
  puts "group_by? sort_by? Diplay_fields? should_compare? show_total? "
  input = gets.chomp
  input = input.split(" ")
  index = 0
  fields.each do |key|
      fields[key] = input[0]
      index += 1
  end
end

give_key = {0 => "id", 1 => "dep", 2 => "math", 3 => "phy", 4 => "chem", 5 => "year"}
fields = {"group_on" => "", "sort_on" => "", "display_fields" => [], "on_compare" => "", "on_total" => ""}

user_input(fields)

out = sort_input(array, fields["sort_on"])
out = group_input(out, fields["group_on"])

compare=[]

if fields["on_compare"] == "true"
    change = []
    puts "First_compare_element? Second_compare_element? "
    compare = gets.chomp
    compare = compare.split(" ")
    change = get_compared(fields, out, compare, give_key, change)
end

if fields["on_total"] == "true"
   total = []
   total = get_total(fields, out, compare, give_key, total)
end

puts ""
final_display(out, change, total, fields)



     

